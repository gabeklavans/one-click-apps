captainVersion: 4
services:
    '$$cap_appname':
        image: linuxserver/wireguard:latest
        environment:
            SERVERURL: '$$cap_appname.$$cap_root_domain'
        volumes:
            - '$$cap_appname-data:/config'
        ports:
            - 5000:5000
            - 51820:51820
        cap_add:
            - NET_ADMIN
        caproverExtra:
            containerHttpPort: '5000'
    '$$cap_appname-ui':
        image: ngoduykhanh/wireguard-ui:latest
        cap_add:
            - NET_ADMIN
        # use the network of the 'wireguard' service. this enables to show active clients in the status page
        network_mode: 'service:$$cap_appname'
        environment:
            - SENDGRID_API_KEY
            - EMAIL_FROM_ADDRESS
            - EMAIL_FROM_NAME
            - SESSION_SECRET
            - WGUI_USERNAME=admin
            - WGUI_PASSWORD=admin
            - WG_CONF_TEMPLATE
            - WGUI_MANAGE_START=true
            - WGUI_MANAGE_RESTART=true
        logging:
            driver: json-file
            options:
                max-size: 50m
        volumes:
        - '$$cap_appname-db:/app/db'
        - '$$cap_appname-config:/etc/wireguard'
caproverOneClickApp:
    variables:
        - id: '$$cap_version'
          label: PrivateBin Version
          defaultValue: '1.3.4'
          description: Check out their Docker page for the valid tags https://hub.docker.com/r/privatebin/nginx-fpm-alpine/tags
          validRegex: "/^([^\\s^\\/])+$/"
        - id: '$$cap_tz'
          label: Time Zone
          defaultValue: America/New_York
          description: Get yours from https://en.wikipedia.org/wiki/List_of_tz_database_time_zones
          validRegex: '/.{1,}/'
    instructions:
        start: |-
            Wireguard!
        end: |-
            Wireguard has been successfully deployed!
    displayName: WireGuard
    isOfficial: false
    description: It's wireguard
    documentation: See https://github.com/PrivateBin/docker-nginx-fpm-alpine
